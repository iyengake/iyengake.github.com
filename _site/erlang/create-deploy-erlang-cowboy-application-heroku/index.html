<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Create and deploy your Erlang / Cowboy Application on Heroku in 30 minutes &#8211; Keerthi Iyengar</title>
<meta name="description" content="Infrastructure, DevOps, BigData, Hadoop.">
<meta name="keywords" content="erlang, heroku">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://iyengake.github.io/images/bg_10.jpg">

<meta name="twitter:title" content="Create and deploy your Erlang / Cowboy Application on Heroku in 30 minutes">
<meta name="twitter:description" content="Infrastructure, DevOps, BigData, Hadoop.">
<meta name="twitter:creator" content="@keerthiiyengar2">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Create and deploy your Erlang / Cowboy Application on Heroku in 30 minutes">
<meta property="og:description" content="Infrastructure, DevOps, BigData, Hadoop.">
<meta property="og:url" content="http://iyengake.github.io/erlang/create-deploy-erlang-cowboy-application-heroku">
<meta property="og:site_name" content="Keerthi Iyengar">
<meta property="og:image" content="http://iyengake.github.io/images/bg_10.jpg">





<link rel="canonical" href="http://iyengake.github.io/erlang/create-deploy-erlang-cowboy-application-heroku">
<link href="http://iyengake.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Keerthi Iyengar Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="stylesheet" type="text/css" href="http://iyengake.github.io/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="http://iyengake.github.io/assets/css/style.css" />

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search...">
        <i class="icon-remove-sign"></i>
        <ul class="search-results post-list"></ul><!-- /.search-results -->
    </div><!-- /.search-form -->
</div><!-- ./search-wrapper -->




<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://iyengake.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://iyengake.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://iyengake.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://iyengake.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://iyengake.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://iyengake.github.io/images/apple-touch-icon-144x144-precomposed.png">

</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">  
<header id="masthead" class="blog-background overlay align-center align-middle animated from-bottom"  style="background-image: url(http://iyengake.github.io/images/bg_10.jpg)" itemscope itemtype="http://schema.org/Organization">


    <div class="inner">
        <div class="container">
            <a class="brand" href="http://iyengake.github.io" role="banner" itemprop="url">
                
                    <img itemprop="logo" src="http://iyengake.github.io/images/omikron.png" alt="Keerthi Iyengar Logo" />

            <h1 class="blog-title light" itemprop="name">
                Keerthi Iyengar
            </h1>
                
            </a>
        </div>
    </div>
    
    
    <div class="decor-wrapper">
        <svg id="header-decor" class="decor bottom" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">
            <path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path>
            <path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path>

            <path class="medium left" d="M0 100 L50 50 L0 33.3" fill="rgba(255,255,255, .3)"></path>
            <path class="medium right" d="M100 100 L50 50 L100 33.3" fill="rgba(255,255,255, .3)"></path>

            <path class="small left" d="M0 100 L50 50 L0 66.6" fill="rgba(255,255,255, .5)"></path>
            <path class="small right" d="M100 100 L50 50 L100 66.6" fill="rgba(255,255,255, .5)"></path>

            <path d="M0 99.9 L50 49.9 L100 99.9 L0 99.9" fill="rgba(255,255,255, 1)"></path>

            <path d="M48 52 L50 49 L52 52 L48 52" fill="rgba(255,255,255, 1)"></path>

        </svg>
    </div>
    
</header>
<div id="main" class="content" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
    <div class="container">
        <div class="row">
            <article class="post col-md-8 col-md-offset-2 hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
            
            
            
                
            
             
             
                    <header class="post-header entry-header">
                        
                        <h1 class="post-title text-center hyper lighter bordered-bottom entry-title" itemprop="headline">Create and deploy your Erlang / Cowboy Application on Heroku in 30 minutes</h1>
                        
                        <div class="post-info text-center small">
                            <span class="entry-date date published"><time datetime="2013-07-13T00:00:00-04:00" class="post-time" itemprop="datePublished">13 Jul 2013</time><span>
                            in <span class="post-tags"><a href="http://iyengake.github.io/categories/index.html#erlang" data-toggle="tooltip" title="Other posts from the Erlang category" rel="tag">Erlang</a></span>&nbsp;<span class="post-tags"><i class="icon-time"></i>&nbsp;8 minutes read</span>
                        </div>
                    </header>
                    <div class="post-body bordered-bottom" itemprop="description">
                        
                        <div style="text-align:center">
  <img src="/images/herloku.png" alt="Herloku" />
</div>
<p><br /></p>

<p><a href="http://www.erlang.org">Erlang</a> is a programming language used to build massively scalable soft real-time systems with requirements on high availability.</p>

<p><a href="https://github.com/extend/cowboy">Cowboy</a> is a small, fast and modular HTTP server written in Erlang.</p>

<p><a href="https://www.heroku.com/">Heroku</a> is a cloud application platform which allows you to deploy and scale your own application at pleasure.</p>

<p>In this post, we will write an Erlang/Cowboy Web Application from scratch, deploying it on Heroku. Since Heroku <a href="https://devcenter.heroku.com/articles/usage-and-billing#750-free-dyno-hours-per-app">offers a free tier for deploying web apps</a>, this will cost you nothing. Also, the entire process should take no more than half an hour.</p>

<h2 id="requirements">Requirements</h2>

<ul>
  <li>You have <a href="http://git-scm.com/">git</a> installed on your machine.</li>
  <li>You have <a href="https://www.erlang-solutions.com/downloads/download-erlang-otp">Erlang</a> installed on your machine. In this example I will be using R15B01.</li>
  <li>You are familiar with the basic concepts of <a href="http://erlang.org/doc/">Erlang and OTP</a></li>
  <li>You have a free account on <a href="https://www.heroku.com/">Heroku</a>.</li>
  <li>You have <a href="https://toolbelt.heroku.com/">the Heroku start-kit for your OS</a> installed.</li>
</ul>

<h2 id="summary">Summary</h2>

<ul>
  <li><a href="#rebar">Create the skeleton of an Erlang app using Rebar</a></li>
  <li><a href="#heroku">Create a Heroku application</a></li>
  <li><a href="#cowboy">Use Cowboy to create a simple web app</a></li>
  <li><a href="#compile">Compile and run your application locally</a></li>
  <li><a href="#config">Configure your Heroku app</a></li>
  <li><a href="#deploy">Deploy your Erlang application on Heroku</a></li>
  <li><a href="#profile">Profile your deployed Erlang application</a></li>
</ul>

<p><a id="rebar"></a></p>

<h3 id="create-the-skeleton-of-an-erlang-app-using-rebar">Create the skeleton of an Erlang app using Rebar</h3>

<p><a href="https://github.com/rebar/rebar">Rebar</a> is the de-facto standard build-tool for Erlang projects.</p>

<p>Fetch rebar from Github and bootstrap it:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git clone https://github.com/rebar/rebar.git
<span class="nv">$ </span><span class="nb">cd </span>rebar
<span class="nv">$ </span>./bootstrap
<span class="nv">$ </span><span class="nb">cd</span> ..</code></pre></div>

<p>Initialize a new git repository and use rebar to create the skeleton for a new Erlang app. I decided to call my application <em>erlblog</em>. Call your application differently, replacing every occurrence of <em>erlblog</em> with your favourite application name in the instructions below. Please note that this is <strong>not</strong> optional, since two applications cannot have the same name on Heroku and you don’t dare to clash with my own application.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git init erlblog
<span class="nv">$ </span><span class="nb">cd </span>erlblog
<span class="nv">$ </span>cp ../rebar/rebar .
<span class="nv">$ </span>./rebar create-app <span class="nv">appid</span><span class="o">=</span>erlblog</code></pre></div>

<p>Commit what you have done in git:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git add rebar src
<span class="nv">$ </span>git commit -m <span class="s2">&quot;Add rebar skeleton&quot;</span></code></pre></div>

<p><a id="heroku"></a></p>

<h3 id="create-a-heroku-application">Create a Heroku application</h3>

<p>Login into Heroku using the <em>heroku</em> command from the terminal.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku login</code></pre></div>

<p>Use your Heroku email and password to login.</p>

<p>Now create a new Heroku app, using the Erlang buildpack from <a href="https://github.com/archaelus">@archaelus</a>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku create erlblog --stack cedar --buildpack https://github.com/archaelus/heroku-buildpack-erlang</code></pre></div>

<p><a id="cowboy"></a></p>

<h3 id="use-cowboy-to-create-a-simple-web-app">Use Cowboy to create a simple web app</h3>

<p>Add the <em>Cowboy</em> web server as a rebar dependency:</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="sc">$ </span><span class="n">cat</span> <span class="n">rebar</span><span class="p">.</span><span class="n">config</span>

<span class="p">{</span><span class="n">deps</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">{</span><span class="n">cowboy</span><span class="p">,</span> <span class="s">&quot;0.8.4&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">git</span><span class="p">,</span> <span class="s">&quot;https://github.com/extend/cowboy.git&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">tag</span><span class="p">,</span> <span class="s">&quot;0.8.4&quot;</span><span class="p">}}}</span>
       <span class="p">]}.</span></code></pre></div>

<p>Add <em>cowboy</em> to the list of applications in your <strong>.app.src</strong> file. Also, set the <em>http_port</em> environment variable to <em>8080</em> (see next paragraphs).</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="sc">$ </span><span class="n">cat</span> <span class="n">src</span><span class="o">/</span><span class="n">erlblog</span><span class="p">.</span><span class="n">app</span><span class="p">.</span><span class="n">src</span>

<span class="p">{</span><span class="n">application</span><span class="p">,</span> <span class="n">erlblog</span><span class="p">,</span>
 <span class="p">[</span>
  <span class="p">{</span><span class="n">description</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="n">vsn</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">},</span>
  <span class="p">{</span><span class="n">registered</span><span class="p">,</span> <span class="p">[]},</span>
  <span class="p">{</span><span class="n">applications</span><span class="p">,</span> <span class="p">[</span>
                  <span class="n">kernel</span><span class="p">,</span>
                  <span class="n">stdlib</span><span class="p">,</span>
                  <span class="n">cowboy</span>
                 <span class="p">]},</span>
  <span class="p">{</span><span class="n">mod</span><span class="p">,</span> <span class="p">{</span> <span class="n">erlblog_app</span><span class="p">,</span> <span class="p">[]}},</span>
  <span class="p">{</span><span class="n">env</span><span class="p">,</span> <span class="p">[{</span><span class="n">http_port</span><span class="p">,</span> <span class="mi">8080</span><span class="p">}]}</span>
 <span class="p">]}.</span></code></pre></div>

<p>Modify the <strong>start/2</strong> function from the <strong>erlblog_app</strong> module so that Cowboy starts a pool of acceptors when the erlblog application is started. Configure the Cowboy dispatcher with a single dispatching rule, routing all requests to <strong>’/’</strong> to the <strong>erlblog_handler</strong> (see below).</p>

<p>Heroku assigns random ports to your application and uses the OS environment variable <em>$PORT</em> to inform you about the port on which your web server should listen to. Therefore, in the following code we read that environment variable, defaulting to port 8080 in case the environment variable is not specified. This is useful, for example, if you want to try your web server locally before deploying it on Heroku.</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="sc">$ </span><span class="n">cat</span> <span class="n">src</span><span class="o">/</span><span class="n">erlblog_app</span><span class="p">.</span><span class="n">erl</span>

<span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">erlblog_app</span><span class="p">).</span>

<span class="p">-</span><span class="ni">behaviour</span><span class="p">(</span><span class="n">application</span><span class="p">).</span>

<span class="c">%% Application callbacks</span>
<span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">start</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">stop</span><span class="o">/</span><span class="mi">1</span><span class="p">]).</span>

<span class="p">-</span><span class="ni">define</span><span class="p">(</span><span class="no">C_ACCEPTORS</span><span class="p">,</span>  <span class="mi">100</span><span class="p">).</span>
<span class="c">%% ===================================================================</span>
<span class="c">%% Application callbacks</span>
<span class="c">%% ===================================================================</span>

<span class="nf">start</span><span class="p">(_</span><span class="nv">StartType</span><span class="p">,</span> <span class="p">_</span><span class="nv">StartArgs</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nv">Routes</span>    <span class="o">=</span> <span class="n">routes</span><span class="p">(),</span>
    <span class="nv">Dispatch</span>  <span class="o">=</span> <span class="nn">cowboy_router</span><span class="p">:</span><span class="nf">compile</span><span class="p">(</span><span class="nv">Routes</span><span class="p">),</span>
    <span class="nv">Port</span>      <span class="o">=</span> <span class="n">port</span><span class="p">(),</span>
    <span class="nv">TransOpts</span> <span class="o">=</span> <span class="p">[{</span><span class="n">port</span><span class="p">,</span> <span class="nv">Port</span><span class="p">}],</span>
    <span class="nv">ProtoOpts</span> <span class="o">=</span> <span class="p">[{</span><span class="n">env</span><span class="p">,</span> <span class="p">[{</span><span class="n">dispatch</span><span class="p">,</span> <span class="nv">Dispatch</span><span class="p">}]}],</span>
    <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="p">_}</span>   <span class="o">=</span> <span class="nn">cowboy</span><span class="p">:</span><span class="nf">start_http</span><span class="p">(</span><span class="n">http</span><span class="p">,</span> <span class="o">?</span><span class="nv">C_ACCEPTORS</span><span class="p">,</span> <span class="nv">TransOpts</span><span class="p">,</span> <span class="nv">ProtoOpts</span><span class="p">),</span>
    <span class="nn">erlblog_sup</span><span class="p">:</span><span class="nf">start_link</span><span class="p">().</span>

<span class="nf">stop</span><span class="p">(_</span><span class="nv">State</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="n">ok</span><span class="p">.</span>

<span class="c">%% ===================================================================</span>
<span class="c">%% Internal functions</span>
<span class="c">%% ===================================================================</span>
<span class="nf">routes</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="p">[</span>
     <span class="p">{</span><span class="n">&#39;_&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">{</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">erlblog_handler</span><span class="p">,</span> <span class="p">[]}</span>
           <span class="p">]}</span>
    <span class="p">].</span>

<span class="nf">port</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="k">case</span> <span class="nn">os</span><span class="p">:</span><span class="nf">getenv</span><span class="p">(</span><span class="s">&quot;PORT&quot;</span><span class="p">)</span> <span class="k">of</span>
        <span class="n">false</span> <span class="o">-&gt;</span>
            <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Port</span><span class="p">}</span> <span class="o">=</span> <span class="nn">application</span><span class="p">:</span><span class="nf">get_env</span><span class="p">(</span><span class="n">http_port</span><span class="p">),</span>
            <span class="nv">Port</span><span class="p">;</span>
        <span class="nv">Other</span> <span class="o">-&gt;</span>
            <span class="nb">list_to_integer</span><span class="p">(</span><span class="nv">Other</span><span class="p">)</span>
    <span class="k">end</span><span class="p">.</span></code></pre></div>

<p>Let’s now implement a basic HTTP Cowboy handler, which simply replies with a 200 status code and a notorious welcoming message to any incoming request:</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="sc">$ </span><span class="n">cat</span> <span class="n">src</span><span class="o">/</span><span class="n">erlblog_handler</span><span class="p">.</span><span class="n">erl</span>

<span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">erlblog_handler</span><span class="p">).</span>

<span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">init</span><span class="o">/</span><span class="mi">3</span><span class="p">]).</span>
<span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">handle</span><span class="o">/</span><span class="mi">2</span><span class="p">]).</span>
<span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">terminate</span><span class="o">/</span><span class="mi">3</span><span class="p">]).</span>

<span class="nf">init</span><span class="p">(_</span><span class="nv">Transport</span><span class="p">,</span> <span class="nv">Req</span><span class="p">,</span> <span class="p">[])</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Req</span><span class="p">,</span> <span class="n">undefined</span><span class="p">}.</span>

<span class="nf">handle</span><span class="p">(</span><span class="nv">Req</span><span class="p">,</span> <span class="nv">State</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Req2</span><span class="p">}</span> <span class="o">=</span> <span class="nn">cowboy_req</span><span class="p">:</span><span class="nf">reply</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">[],</span> <span class="o">&lt;&lt;</span><span class="s">&quot;Hello world!&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="nv">Req</span><span class="p">),</span>
    <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Req2</span><span class="p">,</span> <span class="nv">State</span><span class="p">}.</span>

<span class="nf">terminate</span><span class="p">(_</span><span class="nv">Reason</span><span class="p">,</span> <span class="p">_</span><span class="nv">Req</span><span class="p">,</span> <span class="p">_</span><span class="nv">State</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="n">ok</span><span class="p">.</span></code></pre></div>

<p>Finally, let’s create an interface module which will be responsible for starting your <em>erlblog</em> application together with all its dependencies.</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="sc">$ </span><span class="n">cat</span> <span class="n">src</span><span class="o">/</span><span class="n">erlblog</span><span class="p">.</span><span class="n">erl</span>

<span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">erlblog</span><span class="p">).</span>

<span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">start</span><span class="o">/</span><span class="mi">0</span><span class="p">]).</span>

<span class="nf">start</span><span class="p">()</span> <span class="o">-&gt;</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="nn">application</span><span class="p">:</span><span class="nf">start</span><span class="p">(</span><span class="n">crypto</span><span class="p">),</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="nn">application</span><span class="p">:</span><span class="nf">start</span><span class="p">(</span><span class="n">ranch</span><span class="p">),</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="nn">application</span><span class="p">:</span><span class="nf">start</span><span class="p">(</span><span class="n">cowboy</span><span class="p">),</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="nn">application</span><span class="p">:</span><span class="nf">start</span><span class="p">(</span><span class="n">erlblog</span><span class="p">).</span></code></pre></div>

<p><a id="compile"></a></p>

<h3 id="compile-and-run-your-application-locally">Compile and run your application locally</h3>

<p>Compile the <em>erlblog</em> application using rebar:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>./rebar get-deps compile</code></pre></div>

<p>Start the application and verify that everything works as expected:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>erl -pa ebin deps/*/ebin -s erlblog</code></pre></div>

<p>From the Erlang shell, type:</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="mi">1</span><span class="o">&gt;</span> <span class="nn">application</span><span class="p">:</span><span class="nf">which_applications</span><span class="p">().</span></code></pre></div>

<p>The erlblog application should be included in the output.</p>

<p>Finally, point your browser to:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">http://localhost:8080</code></pre></div>

<p>And verify that the string <em>“Hello World!”</em> is there.</p>

<p>You can use <strong>Ctrl-G q</strong> to exit the Erlang shell.</p>

<p>If everything works as expected, commit everything to git:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git add rebar.config src
git ci -m <span class="s2">&quot;Include Cowboy skeleton&quot;</span></code></pre></div>

<p><a id="config"></a></p>

<h3 id="configure-your-heroku-app">Configure your Heroku app</h3>

<p>You need to tell Heroku that you’re going to deploy an Erlang Application. To do so, you need to create a <em>Procfile</em> file, containing your start-up script:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>cat Procfile

web: erl -pa ebin deps/*/ebin -noshell -noinput -s erlblog</code></pre></div>

<p>Commit your changes to git:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git add Procfile
<span class="nv">$ </span>git ci -m <span class="s2">&quot;Add Procfile&quot;</span></code></pre></div>

<p>You also want to specify that your application requires Erlang R15B01:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>cat .preferred_otp_version

OTP_R15B01</code></pre></div>

<p>Commit your changes to git:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git add .preferred_otp_version
<span class="nv">$ </span>git ci -m <span class="s2">&quot;Specify R15B01 as Erlang version&quot;</span></code></pre></div>

<p><a id="deploy"></a></p>

<h3 id="deploy-your-erlang-application-on-heroku">Deploy your Erlang application on Heroku</h3>

<p>That’s the beautiful part:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>git push heroku master</code></pre></div>

<p>You should now be able to access the erlblog application at:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">http://erlblog.herokuapp.com</code></pre></div>

<p>If something does not work as expected, you might want to verify the logs for your Heroku app:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>heroku logs</code></pre></div>

<p><a id="profile"></a></p>

<h3 id="profile-your-deployed-erlang-application">Profile your deployed Erlang application</h3>

<p>Let’s now verify how many requests our erlblog application can handle. Please note that to run the steps below, you need <a href="http://httpd.apache.org/docs/2.2/programs/ab.html">ab</a> and <a href="http://www.gnuplot.info/">gnuplot</a> installed on your machine.</p>

<p>Using ApacheBench, perform 5000 HTTP requests against your new web server, using 20 concurrent requests. Store the output in the <em>gnuplot.dat</em> file.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>ab -n <span class="m">5000</span> -c <span class="m">20</span> -g gnuplot.dat http://erlblog.herokuapp.com/

This is ApacheBench, Version 2.3 &lt;<span class="nv">$Revision</span>: <span class="m">655654</span> <span class="nv">$&gt;</span>
Copyright <span class="m">1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking erlblog.herokuapp.com <span class="o">(</span>be patient<span class="o">)</span>
Completed <span class="m">500</span> requests
Completed <span class="m">1000</span> requests
Completed <span class="m">1500</span> requests
Completed <span class="m">2000</span> requests
Completed <span class="m">2500</span> requests
Completed <span class="m">3000</span> requests
Completed <span class="m">3500</span> requests
Completed <span class="m">4000</span> requests
Completed <span class="m">4500</span> requests
Completed <span class="m">5000</span> requests
Finished <span class="m">5000</span> requests


Server Software:        Cowboy
Server Hostname:        erlblog.herokuapp.com
Server Port:            80

Document Path:          /
Document Length:        <span class="m">12</span> bytes

Concurrency Level:      20
Time taken <span class="k">for</span> tests:   71.473 seconds
Complete requests:      5000
Failed requests:        0
Write errors:           0
Total transferred:      <span class="m">615000</span> bytes
HTML transferred:       <span class="m">60000</span> bytes
Requests per second:    69.96 <span class="o">[</span><span class="c">#/sec] (mean)</span>
Time per request:       285.891 <span class="o">[</span>ms<span class="o">]</span> <span class="o">(</span>mean<span class="o">)</span>
Time per request:       14.295 <span class="o">[</span>ms<span class="o">]</span> <span class="o">(</span>mean, across all concurrent requests<span class="o">)</span>
Transfer rate:          8.40 <span class="o">[</span>Kbytes/sec<span class="o">]</span> received

Connection Times <span class="o">(</span>ms<span class="o">)</span>
              min  mean<span class="o">[</span>+/-sd<span class="o">]</span> median   max
Connect:      <span class="m">121</span>  <span class="m">130</span>  46.4    <span class="m">127</span>    1317
Processing:   <span class="m">126</span>  <span class="m">154</span>  60.0    <span class="m">140</span>    1176
Waiting:      <span class="m">125</span>  <span class="m">153</span>  60.0    <span class="m">139</span>    1162
Total:        <span class="m">248</span>  <span class="m">284</span>  75.7    <span class="m">268</span>    1495

Percentage of the requests served within a certain <span class="nb">time</span> <span class="o">(</span>ms<span class="o">)</span>
  50%    268
  66%    275
  75%    282
  80%    286
  90%    307
  95%    343
  98%    441
  99%    617
 100%   <span class="m">1495</span> <span class="o">(</span>longest request<span class="o">)</span></code></pre></div>

<p>Using our Heroku free tier (1 single dyno worker), our Cowboy Web Server managed to complete all <strong>5000 requests</strong>, allowing <strong>~70 requests per second</strong>. 90% of the requests have been served in about <strong>300 ms</strong>. Of course, such a good result has been possible only because we surely have been hitting some kind of cache in the Heroku servers. Still, not bad for a free hosting solution for a simple Erlang applications.</p>

<p>We can visualize the above results using Gnuplot:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>gnuplot

gnuplot&gt; plot <span class="s2">&quot;gnuplot.dat&quot;</span> using <span class="m">9</span> smooth sbezier with lines title <span class="s2">&quot;Cowboy Heroku Benchmarking&quot;</span></code></pre></div>

<div style="text-align:center">
  <img src="/images/gnuplot.png" alt="Gnuplot" />
</div>
<p><br /></p>

<p>The complete source code for the <em>erlblog</em> application is available <a href="https://github.com/robertoaloi/erlblog">here</a>.</p>

                        <br>
                    <span class="entry-tags">
                    <p>
                        <i class="icon-tags"></i>&nbsp;Tagged with <a href="http://iyengake.github.io/tags/index.html#erlang" data-toggle="tooltip" title="Posts tagged with erlang" rel="tag">erlang</a>&nbsp;&bull;&nbsp;<a href="http://iyengake.github.io/tags/index.html#heroku" data-toggle="tooltip" title="Posts tagged with heroku" rel="tag">heroku</a>
                    </p>
                    </span>
                    </div>
        </div>
                    <footer class="post-footer entry-meta">
                        <div class="post-share text-center">
    <p class="light small">
        Share this post
    </p>
    <ul class="social-mini">
        <li>
            <a href="https://twitter.com/intent/tweet?text=&quot;Create and deploy your Erlang / Cowboy Application on Heroku in 30 minutes&quot;%20http://iyengake.github.io/erlang/create-deploy-erlang-cowboy-application-heroku%20via%20&#64;keerthiiyengar2"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" data-toggle="tooltip" title="Share on Twitter" itemprop="Twitter">
                <i class="icon-twitter"></i>
            </a>
        </li>
        <li>
            <a  href="https://www.facebook.com/sharer/sharer.php?u=http://iyengake.github.io/erlang/create-deploy-erlang-cowboy-application-heroku"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" data-toggle="tooltip" title="Share on Facebook" itemprop="Facebook">
                <i class="icon-facebook"></i>
            </a>
        </li>
        <li>
            <a href="https://plus.google.com/share?url=http://iyengake.github.io/erlang/create-deploy-erlang-cowboy-application-heroku"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" data-toggle="tooltip" title="Share on Google plus" itemprop="GooglePlus">
                <i class="icon-google-plus"></i>
            </a>
        </li>
    </ul>
</div>
                        <div class="post-author text-center">                       
	        <img src="http://iyengake.github.io/images/roberto-aloi.png" alt="Keerthi Iyengar's photo" itemprop="image" class="post-avatar img-circle img-responsive"/>    
	    <h4 class="bordered-bottom vcard author" itemprop="author" itemscope itemtype="http://schema.org/Person">By <span itemprop="name" class="fn"><a href="http://iyengake.github.io/about" title="About Keerthi Iyengar" itemprop="url">Keerthi Iyengar</a></span></h4>
	    <p>Keerthi Iyengar...</p>
</div> 
                        <div id="disqus_thread"></div><!-- /#disqus_thread -->
                    </footer>
            </article>
    </div>
</div>

<footer id="footer"  class="blog-background overlay text-center align-middle animated from-top" style="background-image: url(http://iyengake.github.io/images/bg_10.jpg)" >


    <div class="inner">
        <div class="container">

            <ul class="social-icons">
            
            <li>
                <a href="http://twitter.com/keerthiiyengar2" data-toggle="tooltip" title="Keerthi Iyengar on Twitter" target="_blank">
                    <i class="icon-twitter"></i>
                </a>
            </li>
            
            
            
            
            
            <li>
                <a href="http://github.com/iyengake" data-toggle="tooltip" title="Keerthi Iyengar on Github" target="_blank">
                    <i class="icon-github"></i>
                </a>
            </li>
        </ul>
            <p class="copy-text">
                <a href="http://iyengake.github.io/about/">Keerthi Iyengar</a> &copy; 2015 &bull; All rights reserved.
            </p>
            <p class="copy-text">
                Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <i class="icon-heart"></i> <a href="http://alum.mit.edu/www/hmfaysal/">HMFAYSAL OMEGA</a> theme.
            </p>
            <ul class="menu-items">
            
            <li>
                
                    <a href="http://iyengake.github.io/"><i class="icon-home"></i></a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="http://iyengake.github.io/categories">Categories</a>&nbsp;&bull;
                 
            </li>
            
            <li><a href="http://iyengake.github.io/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
            &nbsp;&bull;<li class="dosearch"><i class="icon-search"></i> Search</li>
        </ul>
        </div>
    </div>
    
        <div class="decor-wrapper">
            <svg id="footer-decor" class="decor top" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">

                <path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path>
                <path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path>

                <path class="medium left" d="M0 0 L50 50 L0 66.6" fill="rgba(255,255,255, .3)"></path>
                <path class="medium right" d="M100 0 L50 50 L100 66.6" fill="rgba(255,255,255, .3)"></path>

                <path class="small left" d="M0 0 L50 50 L0 33.3" fill="rgba(255,255,255, .5)"></path>
                <path class="small right" d="M100 0 L50 50 L100 33.3" fill="rgba(255,255,255, .5)"></path>

                <path d="M0 0 L50 50 L100 0 L0 0" fill="rgba(255,255,255, 1)"></path>

                <path d="M48 48 L50 51 L52 48 L48 48" fill="rgba(255,255,255, 1)"></path>

            </svg>
        </div>
    
</footer>

    
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://iyengake.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://iyengake.github.io/assets/js/scripts.min.js"></script>
    <script type="text/javascript" src="http://iyengake.github.io/assets/js/waypoints.min.js"></script>
    <script type="text/javascript" src="http://iyengake.github.io/assets/js/script.js"></script>


<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : 'http://iyengake.github.io/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'iyengake'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> 
</body>
</html>