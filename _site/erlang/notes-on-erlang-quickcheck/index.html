<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Notes on Erlang QuickCheck &#8211; Keerthi Iyengar</title>
<meta name="description" content="Infrastructure, DevOps, BigData, Hadoop.">
<meta name="keywords" content="erlang, testing, quickcheck">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://iyengake.github.io/images/bg_07.jpg">

<meta name="twitter:title" content="Notes on Erlang QuickCheck">
<meta name="twitter:description" content="Infrastructure, DevOps, BigData, Hadoop.">
<meta name="twitter:creator" content="@keerthiiyengar2">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Notes on Erlang QuickCheck">
<meta property="og:description" content="Infrastructure, DevOps, BigData, Hadoop.">
<meta property="og:url" content="http://iyengake.github.io/erlang/notes-on-erlang-quickcheck">
<meta property="og:site_name" content="Keerthi Iyengar">
<meta property="og:image" content="http://iyengake.github.io/images/bg_07.jpg">





<link rel="canonical" href="http://iyengake.github.io/erlang/notes-on-erlang-quickcheck">
<link href="http://iyengake.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Keerthi Iyengar Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="stylesheet" type="text/css" href="http://iyengake.github.io/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="http://iyengake.github.io/assets/css/style.css" />

<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search...">
        <i class="icon-remove-sign"></i>
        <ul class="search-results post-list"></ul><!-- /.search-results -->
    </div><!-- /.search-form -->
</div><!-- ./search-wrapper -->




<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://iyengake.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://iyengake.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://iyengake.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://iyengake.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://iyengake.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://iyengake.github.io/images/apple-touch-icon-144x144-precomposed.png">

</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">  
<header id="masthead" class="blog-background overlay align-center align-middle animated from-bottom"  style="background-image: url(http://iyengake.github.io/images/bg_07.jpg)" itemscope itemtype="http://schema.org/Organization">


    <div class="inner">
        <div class="container">
            <a class="brand" href="http://iyengake.github.io" role="banner" itemprop="url">
                
                    <img itemprop="logo" src="http://iyengake.github.io/images/omikron.png" alt="Keerthi Iyengar Logo" />

            <h1 class="blog-title light" itemprop="name">
                Keerthi Iyengar
            </h1>
                
            </a>
        </div>
    </div>
    
    
    <div class="decor-wrapper">
        <svg id="header-decor" class="decor bottom" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">
            <path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path>
            <path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path>

            <path class="medium left" d="M0 100 L50 50 L0 33.3" fill="rgba(255,255,255, .3)"></path>
            <path class="medium right" d="M100 100 L50 50 L100 33.3" fill="rgba(255,255,255, .3)"></path>

            <path class="small left" d="M0 100 L50 50 L0 66.6" fill="rgba(255,255,255, .5)"></path>
            <path class="small right" d="M100 100 L50 50 L100 66.6" fill="rgba(255,255,255, .5)"></path>

            <path d="M0 99.9 L50 49.9 L100 99.9 L0 99.9" fill="rgba(255,255,255, 1)"></path>

            <path d="M48 52 L50 49 L52 52 L48 52" fill="rgba(255,255,255, 1)"></path>

        </svg>
    </div>
    
</header>
<div id="main" class="content" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
    <div class="container">
        <div class="row">
            <article class="post col-md-8 col-md-offset-2 hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
            
            
            
                
            
             
             
                    <header class="post-header entry-header">
                        
                        <h1 class="post-title text-center hyper lighter bordered-bottom entry-title" itemprop="headline">Notes on Erlang QuickCheck</h1>
                        
                        <div class="post-info text-center small">
                            <span class="entry-date date published"><time datetime="2014-09-12T00:00:00-04:00" class="post-time" itemprop="datePublished">12 Sep 2014</time><span>
                            in <span class="post-tags"><a href="http://iyengake.github.io/categories/index.html#erlang" data-toggle="tooltip" title="Other posts from the Erlang category" rel="tag">Erlang</a></span>&nbsp;<span class="post-tags"><i class="icon-time"></i>&nbsp;6 minutes read</span>
                        </div>
                    </header>
                    <div class="post-body bordered-bottom" itemprop="description">
                        
                        <p>A few days ago I had the chance to spend some time with John Hughes,
one of the creators of the <a href="http://www.quviq.com/products/erlang-quickcheck/">Erlang
Quickcheck</a>.
We looked at some of our APIs and went through some of our QuickCheck models.
It has been an incredibly helpful learning experience, so I thought to
share some of the highlights from our discussions to a broader public.</p>

<p>The following notes are listed in a more or less random order
and they assume that you are already familiar with QuickCheck (<em>EQC</em>) and
QuickCheck abstract state machines.</p>

<h3 id="generating-sublists">Generating sublists</h3>

<p>Given a list of items - say, atoms - you want to extract random sublists
from the original list.</p>

<p>One way of doing this is to pair
each element of the list with a boolean generator and to filter out
<em>false</em> values:</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="nf">sublist</span><span class="p">(</span><span class="nv">L0</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="o">?</span><span class="nv">LET</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span> <span class="p">[{</span><span class="nv">E</span><span class="p">,</span> <span class="nn">eqc_gen</span><span class="p">:</span><span class="nf">bool</span><span class="p">()}</span> <span class="p">||</span> <span class="nv">E</span> <span class="o">&lt;-</span> <span class="nv">L0</span><span class="p">],</span> <span class="p">[</span><span class="nv">X</span> <span class="p">||</span> <span class="p">{</span><span class="nv">X</span><span class="p">,</span> <span class="n">true</span><span class="p">}</span> <span class="o">&lt;-</span> <span class="nv">L</span><span class="p">]).</span></code></pre></div>

<p>Since the boolean generator shrinks towards the <em>false</em> value, your
sublist shrinks towards the empty list, which is
what you want in most cases. If you need to invert this behaviour and
you want to shrink - or should I say <em>grow</em> - towards the entire list, you can
simply toggle the <em>true</em> boolean and set it to <em>false</em>:</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="nf">sublist</span><span class="p">(</span><span class="nv">L0</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="o">?</span><span class="nv">LET</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span> <span class="p">[{</span><span class="nv">E</span><span class="p">,</span> <span class="nn">eqc_gen</span><span class="p">:</span><span class="nf">bool</span><span class="p">()}</span> <span class="p">||</span> <span class="nv">E</span> <span class="o">&lt;-</span> <span class="nv">L0</span><span class="p">],</span> <span class="p">[</span><span class="nv">X</span> <span class="p">||</span> <span class="p">{</span><span class="nv">X</span><span class="p">,</span> <span class="n">false</span><span class="p">}</span> <span class="o">&lt;-</span> <span class="nv">L</span><span class="p">]).</span></code></pre></div>

<h3 id="use-elements1-or-oneof1">Use <code>elements/1</code> or <code>oneof/1</code>?</h3>

<p>In QuickCheck two similar functions are available: <code>elements/1</code> and
<code>oneof/1</code>. They look similar at a first glance, so you may wonder
which one to use.</p>

<p>The main difference between the two functions stands in the input arguments.
The <code>elements/1</code> takes a list of terms as input and it generates an
element from it, whilst <code>oneof/1</code> takes a list of generators and it
picks one of them.</p>

<p>The above is important for how the two functions shrink. <code>elements/1</code>
shrinks towards the first element of the list, whilst <code>oneof/1</code>
shrinks towards the <em>failing</em> one.</p>

<h3 id="verify-your-generators">Verify your generators</h3>

<p>Whenever you implement a new generator or even if you simply use a
built-in one, you may want to verify that the generator works
as you expect. You can use <code>eqc_gen:sample/1</code> for the purpose.</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="o">&gt;</span> <span class="nn">eqc_gen</span><span class="p">:</span><span class="nf">sample</span><span class="p">(</span><span class="nn">eqc_gen</span><span class="p">:</span><span class="nf">list</span><span class="p">(</span><span class="nn">eqc_gen</span><span class="p">:</span><span class="nf">nat</span><span class="p">())).</span>
<span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="p">[]</span>
<span class="s">&quot;</span><span class="se">\t\b\f</span><span class="s">&quot;</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="p">[]</span>
<span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">]</span>
<span class="p">[</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ok</span></code></pre></div>

<p>This is also useful to verify the sequence of commands that your abstract state
machine can generate:</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="o">&gt;</span> <span class="nn">eqc_gen</span><span class="p">:</span><span class="nf">sample</span><span class="p">(</span><span class="nn">eqc_statem</span><span class="p">:</span><span class="nf">commands</span><span class="p">(</span><span class="n">my_eqc</span><span class="p">)).</span>
<span class="o">&gt;</span> <span class="nn">eqc_gen</span><span class="p">:</span><span class="nf">sample</span><span class="p">(</span><span class="nn">eqc_statem</span><span class="p">:</span><span class="nf">parallel_commands</span><span class="p">(</span><span class="n">my_eqc</span><span class="p">)).</span></code></pre></div>

<p>Where <code>my_eqc</code> is the module where your <em>eqc_statem</em> is defined.</p>

<h3 id="think-shrinking">Think shrinking</h3>

<p>The <code>elements/1</code> generator shrinks towards the beginning of the list.
Keep that in mind when implementing your QuickCheck abstract state machines. If
you keep a list of elements - say, pids - in your model state and you
plan to use <code>elements/1</code> on them, ensure that whenever a new element is added
to the state, it is always appended at the end of a list, <a href="http://www.erlang.org/doc/efficiency_guide/myths.html#id56691">even if you
are a seasoned Erlang developer and it feels a bit unnatural to
you</a>. This
will give you better shrinking in most cases.</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="err">###</span> <span class="nv">DO</span>
<span class="nf">add_next</span><span class="p">(</span><span class="nv">S</span><span class="p">,</span> <span class="nv">Res</span><span class="p">,</span> <span class="p">[</span><span class="nv">Pid</span><span class="p">])</span> <span class="o">-&gt;</span>
  <span class="nv">S</span><span class="nl">#state</span><span class="p">{</span><span class="n">pids</span> <span class="o">=</span> <span class="nv">S</span><span class="nl">#state.pids</span> <span class="o">++</span> <span class="p">[</span><span class="nv">Pid</span><span class="p">]}</span>

<span class="err">###</span> <span class="nv">DON</span><span class="err">&#39;</span><span class="nv">T</span>
<span class="nf">add_next</span><span class="p">(</span><span class="nv">S</span><span class="p">,</span> <span class="nv">Res</span><span class="p">,</span> <span class="p">[</span><span class="nv">Pid</span><span class="p">])</span> <span class="o">-&gt;</span>
  <span class="nv">S</span><span class="nl">#state</span><span class="p">{</span><span class="n">pids</span> <span class="o">=</span> <span class="p">[</span><span class="nv">Pid</span> <span class="p">|</span> <span class="nv">S</span><span class="nl">#state.pids</span><span class="p">]}</span></code></pre></div>

<p>Don’t bother about quadratic complexity here, since you will only run
this code during tests and you will probably have only a few elements
in your state at any given time.</p>

<h3 id="living-in-the-erlang-shell">Living in the Erlang shell</h3>

<p>Sometimes the feedback loop for executing QuickCheck tests is
long and/or the way properties are verified is inflexible. As an
example, you may be wrapping your QuickCheck
properties in EUnit suites to get code coverage information, or you
may run QuickCheck via <a href="https://github.com/basho/rebar">rebar</a>.</p>

<p>When implementing a new property or debugging an abstract state
machine, try to run QuickCheck from the Erlang shell as much as
possible. Being able to run <code>eqc:check/1</code> on your latest
counterexample, to verify the list of generated commands using the
<code>sample/1</code> function (as explained above) and to re-run a
property in seconds after a quick fix is a great win in the
long term.</p>

<h3 id="how-long-will-my-commands-take">How long will my commands take?</h3>

<p>In your QuickCheck abstract state machine, you could have operations which take
long time, so you may want to set a timeout for the entire test suite. You don’t
want to set the timeout too small, to avoid incurring into <em>occasionaly
failing test cases</em> (due to the timeout being hit, in case long
sequences of commands are generated). On the other hand, you don’t
want to set the timeout too long, since you don’t want your tests to
run forever. So, what’s a good value for a timeout?</p>

<p>Well, since the sequence of command is available in your property, you
could calculate a timeout value from the sequence of commands itself.
The following snippet should give you a better idea of what I mean here.</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="nf">prop_bar</span><span class="p">()</span> <span class="o">-&gt;</span>
   <span class="o">?</span><span class="nv">FORALL</span><span class="p">(</span><span class="nv">Cmds</span><span class="p">,</span> <span class="n">commands</span><span class="p">(),</span>
     <span class="o">?</span><span class="nv">TIMEOUT</span><span class="p">(</span><span class="n">my_timeout</span><span class="p">(</span><span class="nv">Cmds</span><span class="p">),</span>
       <span class="k">begin</span>
        <span class="p">...</span>
       <span class="k">end</span><span class="p">)).</span>

<span class="nf">my_timeout</span><span class="p">(</span><span class="nv">Cmds</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nn">lists</span><span class="p">:</span><span class="nf">sum</span><span class="p">([</span><span class="n">expected_time</span><span class="p">(</span><span class="nv">Cmd</span><span class="p">)</span> <span class="p">||</span> <span class="nv">Cmd</span> <span class="o">&lt;-</span> <span class="nv">Cmds</span><span class="p">]).</span>

<span class="nf">expected_time</span><span class="p">({</span><span class="n">call</span><span class="p">,</span> <span class="o">?</span><span class="nv">MODULE</span><span class="p">,</span> <span class="n">op1</span><span class="p">,</span> <span class="p">_</span><span class="nv">Args</span><span class="p">})</span> <span class="o">-&gt;</span>
  <span class="mi">2000</span><span class="p">;</span>
<span class="nf">expected_time</span><span class="p">({</span><span class="n">call</span><span class="p">,</span> <span class="o">?</span><span class="nv">MODULE</span><span class="p">,</span> <span class="n">op2</span><span class="p">,</span> <span class="p">_</span><span class="nv">Args</span><span class="p">})</span> <span class="o">-&gt;</span>
  <span class="mi">3000</span><span class="p">.</span></code></pre></div>

<h3 id="non-derministic-test-outcomes">Non derministic test outcomes</h3>

<p>In certain situations test outcomes are non-deterministic.
In such cases, have a look to the <code>?SOMETIMES/2</code> macro.
An extract from the QuickCheck documentation follows.</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="o">?</span><span class="nv">SOMETIMES</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="nv">Prop</span><span class="p">)</span>

<span class="nv">A</span> <span class="n">property</span> <span class="n">which</span> <span class="n">tests</span> <span class="nv">Prop</span> <span class="n">repeatedly</span> <span class="nv">N</span> <span class="n">times</span><span class="p">,</span> <span class="n">failing</span> <span class="n">only</span> <span class="k">if</span> <span class="n">all</span> <span class="k">of</span> <span class="n">the</span>
<span class="n">tests</span> <span class="n">fail</span><span class="p">.</span> <span class="nv">In</span> <span class="n">other</span> <span class="n">words</span><span class="p">,</span> <span class="n">the</span> <span class="n">property</span> <span class="n">passes</span> <span class="k">if</span> <span class="nv">Prop</span> <span class="n">sometimes</span> <span class="n">passes</span><span class="p">.</span>
<span class="nv">This</span> <span class="n">is</span> <span class="n">used</span> <span class="n">in</span> <span class="n">situations</span> <span class="n">where</span> <span class="n">test</span> <span class="n">outcomes</span> <span class="n">are</span> <span class="n">non</span><span class="o">-</span><span class="n">deterministic</span><span class="p">,</span>
<span class="n">to</span> <span class="n">search</span> <span class="n">for</span> <span class="n">test</span> <span class="n">cases</span> <span class="n">that</span> <span class="n">consistently</span> <span class="n">fail</span><span class="p">.</span>
<span class="nv">A</span> <span class="n">property</span> <span class="n">such</span> <span class="n">as</span> <span class="o">?</span><span class="nv">FORALL</span><span class="p">(</span><span class="nv">X</span><span class="p">,...,</span><span class="o">?</span><span class="nv">SOMETIMES</span><span class="p">(</span><span class="mi">10</span><span class="p">,...))</span> <span class="n">will</span> <span class="n">find</span> <span class="n">test</span> <span class="n">cases</span> <span class="nv">X</span> <span class="n">for</span>
<span class="n">which</span> <span class="n">the</span> <span class="n">property</span> <span class="n">inside</span> <span class="o">?</span><span class="nv">SOMETIMES</span> <span class="n">is</span> <span class="n">very</span> <span class="n">likely</span> <span class="n">to</span> <span class="n">fail</span><span class="p">.</span></code></pre></div>

<h3 id="more-compacted-state-machines">More compacted State Machines</h3>

<p>The most recent versions of QuickCheck have a new format for defining
an abstract state machine, which is more readable and concise and which requires
much less boilerplate than before. You can
find extensive documentation about the new <em>statem</em> format by looking at the
documentation in the <code>eqc_group_commands</code> module. Not easy to find, which is
why I’m mentioning it here.</p>

<h3 id="failing-is-good">Failing is good</h3>

<p>Too often your QuickCheck tests pass and your properties are
successful. In many occasions it’s useful to ensure that your tests
are meaningful by testing properties that should <em>not</em> succeed. You
can perform negative testing by wrapping a property using the
<code>eqc:fails/1</code> function.</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="nf">fails</span><span class="p">(</span><span class="o">?</span><span class="nv">FORALL</span><span class="p">(...))</span></code></pre></div>

<h3 id="testing-race-conditions">Testing race conditions</h3>

<p>In QuickCheck, going from sequential testing to parallel testing is a
snap in most cases. As an example, the following property:</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="nf">prop_registry</span><span class="p">()</span> <span class="o">-&gt;</span>
  <span class="o">?</span><span class="nv">FORALL</span><span class="p">(</span><span class="nv">Cmds</span><span class="p">,</span> <span class="n">commands</span><span class="p">(</span><span class="o">?</span><span class="nv">MODULE</span><span class="p">),</span>
    <span class="k">begin</span>
      <span class="n">cleanup</span><span class="p">(),</span>
      <span class="p">{</span><span class="nv">H</span><span class="p">,</span> <span class="nv">S</span><span class="p">,</span> <span class="nv">Res</span><span class="p">}</span> <span class="o">=</span> <span class="n">run_commands</span><span class="p">(</span><span class="o">?</span><span class="nv">MODULE</span><span class="p">,</span> <span class="nv">Cmds</span><span class="p">),</span>
      <span class="n">pretty_commands</span><span class="p">(</span><span class="o">?</span><span class="nv">MODULE</span><span class="p">,</span> <span class="nv">Cmds</span><span class="p">,</span> <span class="p">{</span><span class="nv">H</span><span class="p">,</span> <span class="nv">S</span><span class="p">,</span> <span class="nv">Res</span><span class="p">},</span>
                      <span class="n">aggregate</span><span class="p">(</span><span class="n">command_names</span><span class="p">(</span><span class="nv">Cmds</span><span class="p">),</span>
                      <span class="nv">Res</span> <span class="o">==</span> <span class="n">ok</span><span class="p">))</span>
    <span class="k">end</span><span class="p">).</span></code></pre></div>

<p>Would become:</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="nf">prop_registry</span><span class="p">()</span> <span class="o">-&gt;</span>
  <span class="o">?</span><span class="nv">FORALL</span><span class="p">(</span><span class="nv">Cmds</span><span class="p">,</span> <span class="n">parallel_commands</span><span class="p">(</span><span class="o">?</span><span class="nv">MODULE</span><span class="p">),</span>
    <span class="k">begin</span>
      <span class="n">cleanup</span><span class="p">(),</span>
      <span class="p">{</span><span class="nv">H</span><span class="p">,</span> <span class="nv">S</span><span class="p">,</span> <span class="nv">Res</span><span class="p">}</span> <span class="o">=</span> <span class="n">run_parallel_commands</span><span class="p">(</span><span class="o">?</span><span class="nv">MODULE</span><span class="p">,</span> <span class="nv">Cmds</span><span class="p">),</span>
      <span class="n">pretty_commands</span><span class="p">(</span><span class="o">?</span><span class="nv">MODULE</span><span class="p">,</span> <span class="nv">Cmds</span><span class="p">,</span> <span class="p">{</span><span class="nv">H</span><span class="p">,</span> <span class="nv">S</span><span class="p">,</span> <span class="nv">Res</span><span class="p">},</span>
                      <span class="n">aggregate</span><span class="p">(</span><span class="n">command_names</span><span class="p">(</span><span class="nv">Cmds</span><span class="p">),</span>
                      <span class="nv">Res</span> <span class="o">==</span> <span class="n">ok</span><span class="p">))</span>
    <span class="k">end</span><span class="p">).</span></code></pre></div>

<p>You can use <em>preconditions</em> to ensure logical precedence between operations.</p>

<h3 id="running-on-multicore">Running on multicore</h3>

<p>If you are testing race conditions and you are using <code>parallel_cmds</code> as above,
ensure you are running on a multicore system. Do not underestimate
this requisite since, even if your machine has at least 4 or 8 cores,
your application could be running in a VM or in a Jenkins slave with
limited cores. In such a situation, in fact, the Erlang scheduler will
try as hard as possible to prevent context switches between processes
and your parallel tests may be less useful than you think.</p>

<h3 id="about-check1-and-check2">About <code>check/1</code> and <code>check/2</code></h3>

<p>It’s possible to test a property for a given case (usually the current
counterexample) by using the <code>check/1</code> and <code>check/2</code> functions
exported by the <code>eqc</code> module. An interesting application of the
<code>check</code> functions is in a system where plenty of log information are
produced by the system under test while running QuickCheck. By using
the following pattern, it will be possible to replay a failing test
case and to display only relevant logs.</p>

<div class="highlight"><pre><code class="language-erlang" data-lang="erlang"><span class="k">case</span> <span class="nn">eqc</span><span class="p">:</span><span class="nf">quickcheck</span><span class="p">(</span><span class="nv">Property</span><span class="p">)</span> <span class="k">of</span>
        <span class="n">true</span> <span class="o">-&gt;</span> <span class="n">true</span><span class="p">;</span>
        <span class="p">_</span>    <span class="o">-&gt;</span> <span class="nn">io</span><span class="p">:</span><span class="nf">format</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="s">&quot;Repeating failing test</span><span class="si">~n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="n">true</span> <span class="o">=</span> <span class="nn">eqc</span><span class="p">:</span><span class="nf">check</span><span class="p">(</span><span class="nv">Prop</span><span class="p">)</span>
<span class="k">end</span><span class="p">.</span></code></pre></div>

<p>As a plus, the <code>check/2</code> function can be used without a QuickCheck
licence, allowing anyone to run tests that a licenced user has
generated.</p>

                        <br>
                    <span class="entry-tags">
                    <p>
                        <i class="icon-tags"></i>&nbsp;Tagged with <a href="http://iyengake.github.io/tags/index.html#erlang" data-toggle="tooltip" title="Posts tagged with erlang" rel="tag">erlang</a>&nbsp;&bull;&nbsp;<a href="http://iyengake.github.io/tags/index.html#testing" data-toggle="tooltip" title="Posts tagged with testing" rel="tag">testing</a>&nbsp;&bull;&nbsp;<a href="http://iyengake.github.io/tags/index.html#quickcheck" data-toggle="tooltip" title="Posts tagged with quickcheck" rel="tag">quickcheck</a>
                    </p>
                    </span>
                    </div>
        </div>
                    <footer class="post-footer entry-meta">
                        <div class="post-share text-center">
    <p class="light small">
        Share this post
    </p>
    <ul class="social-mini">
        <li>
            <a href="https://twitter.com/intent/tweet?text=&quot;Notes on Erlang QuickCheck&quot;%20http://iyengake.github.io/erlang/notes-on-erlang-quickcheck%20via%20&#64;keerthiiyengar2"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" data-toggle="tooltip" title="Share on Twitter" itemprop="Twitter">
                <i class="icon-twitter"></i>
            </a>
        </li>
        <li>
            <a  href="https://www.facebook.com/sharer/sharer.php?u=http://iyengake.github.io/erlang/notes-on-erlang-quickcheck"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" data-toggle="tooltip" title="Share on Facebook" itemprop="Facebook">
                <i class="icon-facebook"></i>
            </a>
        </li>
        <li>
            <a href="https://plus.google.com/share?url=http://iyengake.github.io/erlang/notes-on-erlang-quickcheck"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" data-toggle="tooltip" title="Share on Google plus" itemprop="GooglePlus">
                <i class="icon-google-plus"></i>
            </a>
        </li>
    </ul>
</div>
                        <div class="post-author text-center">                       
	        <img src="http://iyengake.github.io/images/roberto-aloi.png" alt="Keerthi Iyengar's photo" itemprop="image" class="post-avatar img-circle img-responsive"/>    
	    <h4 class="bordered-bottom vcard author" itemprop="author" itemscope itemtype="http://schema.org/Person">By <span itemprop="name" class="fn"><a href="http://iyengake.github.io/about" title="About Keerthi Iyengar" itemprop="url">Keerthi Iyengar</a></span></h4>
	    <p>Keerthi Iyengar...</p>
</div> 
                        <div id="disqus_thread"></div><!-- /#disqus_thread -->
                    </footer>
            </article>
    </div>
</div>

<footer id="footer"  class="blog-background overlay text-center align-middle animated from-top" style="background-image: url(http://iyengake.github.io/images/bg_07.jpg)" >


    <div class="inner">
        <div class="container">

            <ul class="social-icons">
            
            <li>
                <a href="http://twitter.com/keerthiiyengar2" data-toggle="tooltip" title="Keerthi Iyengar on Twitter" target="_blank">
                    <i class="icon-twitter"></i>
                </a>
            </li>
            
            
            
            
            
            <li>
                <a href="http://github.com/iyengake" data-toggle="tooltip" title="Keerthi Iyengar on Github" target="_blank">
                    <i class="icon-github"></i>
                </a>
            </li>
        </ul>
            <p class="copy-text">
                <a href="http://iyengake.github.io/about/">Keerthi Iyengar</a> &copy; 2015 &bull; All rights reserved.
            </p>
            <p class="copy-text">
                Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <i class="icon-heart"></i> <a href="http://alum.mit.edu/www/hmfaysal/">HMFAYSAL OMEGA</a> theme.
            </p>
            <ul class="menu-items">
            
            <li>
                
                    <a href="http://iyengake.github.io/"><i class="icon-home"></i></a>&nbsp;&bull;
                 
            </li>
            
            <li>
                
                    <a href="http://iyengake.github.io/categories">Categories</a>&nbsp;&bull;
                 
            </li>
            
            <li><a href="http://iyengake.github.io/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
            &nbsp;&bull;<li class="dosearch"><i class="icon-search"></i> Search</li>
        </ul>
        </div>
    </div>
    
        <div class="decor-wrapper">
            <svg id="footer-decor" class="decor top" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 100 100" preserveAspectRatio="none">

                <path class="large left" d="M0 0 L50 50 L0 100" fill="rgba(255,255,255, .1)"></path>
                <path class="large right" d="M100 0 L50 50 L100 100" fill="rgba(255,255,255, .1)"></path>

                <path class="medium left" d="M0 0 L50 50 L0 66.6" fill="rgba(255,255,255, .3)"></path>
                <path class="medium right" d="M100 0 L50 50 L100 66.6" fill="rgba(255,255,255, .3)"></path>

                <path class="small left" d="M0 0 L50 50 L0 33.3" fill="rgba(255,255,255, .5)"></path>
                <path class="small right" d="M100 0 L50 50 L100 33.3" fill="rgba(255,255,255, .5)"></path>

                <path d="M0 0 L50 50 L100 0 L0 0" fill="rgba(255,255,255, 1)"></path>

                <path d="M48 48 L50 51 L52 48 L48 48" fill="rgba(255,255,255, 1)"></path>

            </svg>
        </div>
    
</footer>

    
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://iyengake.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://iyengake.github.io/assets/js/scripts.min.js"></script>
    <script type="text/javascript" src="http://iyengake.github.io/assets/js/waypoints.min.js"></script>
    <script type="text/javascript" src="http://iyengake.github.io/assets/js/script.js"></script>


<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : 'http://iyengake.github.io/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'iyengake'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> 
</body>
</html>